{% extends 'base.html' %}

{% load static %}

{% block title %}EPOBS - View Expense{% endblock %}

{% block breadcrumb %}
  <li class="breadcrumb-item">Expenses</li>
  <li class="breadcrumb-item">View</li>
{% endblock %}

{% block content %}
  {% if expense.corrected_by_cje %}
  <div class="alert alert-danger">
    {% if expense.corrected_by_cje.approval_status == 'A' %}
      This transaction has been corrected by a
    {% else %}
      This transaction is in the process of being corrected by a
    {% endif %}
    <a href="{% url 'view_expense_cje' expense.corrected_by_cje.pk %}">journal entry</a>.
  </div>
  {% endif %}

  {% if expense.reversal_for_cje %}
  <div class="alert alert-light">
    This transaction reverses an error in
    <a href="{% url 'view_expense' expense.reversal_for_cje.correction_to.pk %}">{{ expense.reversal_for_cje.correction_to }}</a>.
  </div>
  {% endif %}

  {% if expense.restatement_for_cje %}
  <div class="alert alert-light">
    This transaction replaces
    <a href="{% url 'view_expense' expense.restatement_for_cje.correction_to.pk %}">{{ expense.restatement_for_cje.correction_to }}</a>.
  </div>
  {% endif %}

  <table class="table">
    <tr><th>Ledger Account:</th><td>{{ expense.ledger_account }}</td></tr>
    <tr><th>Payee:</th><td>{{ expense.payee }}</td></tr>
    <tr><th>Amount:</th><td>{{ expense.amount }}</td></tr>
    <tr><th>Created:</th><td>{{ expense.created }} by {{ expense.created_by }}</td></tr>
    <tr><th>Status:</th><td>{{ expense.get_approval_status_display }}</td></tr>
    {% if expense.approval_status == 'S' %}<tr><th>Submitted:</th><td>{{ expense.date_submitted }} by {{ expense.submitted_by }}</td></tr>{% endif %}
    {% if expense.approval_status == 'A' %}<tr><th>Approved:</th><td>{{ expense.date_approved }} by {{ expense.approved_by }}</td></tr>{% endif %}
    {% if expense.notes %}<tr><th>Notes:</th><td>{{ expense.notes }}</td></tr>{% endif %}
    {% if expense.discount %}<tr><th>Discount:</th><td>{{ expense.discount }}</td></tr>{% endif %}
    {% if expense.quantity %}<tr><th>Quantity:</th><td>{{ expense.quantity }}</td></tr>{% endif %}
    {% if expense.unit_cost %}<tr><th>Cost:</th><td>{{ expense.unit_cost }}{% if expense.unit_cost %} per {{ expense.unit_of_measure }}{% endif %}</td></tr>{% endif %}
  </table>

  {% if expense.approval_status == 'S' and perms.finance.approve_expensetransaction and user != expense.submitted_by %}
    <a href="{% url 'approve_expense' expense.pk %}"><span class="btn btn-secondary">Approve</span></a>
  {% endif %}
  {% if expense.approval_status == 'S' and perms.finance.change_expensetransaction %}
    <a href="{% url 'unsubmit_expense' expense.pk %}"><span class="btn btn-secondary">Revert to draft</span></a>
  {% endif %}
  {% if expense.approval_status == 'D' and perms.finance.change_expensetransaction %}
    <a href="{% url 'submit_expense' expense.pk %}"><span class="btn btn-secondary">Submit for Approval</span></a>
    <a href="{% url 'edit_expense' expense.pk %}"><span class="btn btn-secondary">Edit</span></a>
  {% endif %}
  {% if expense.approval_status == 'A' and perms.finance.add_expensecorrectivejournalentry and not expense.corrected_by_cje and not expense.reversal_for_cje %}
    <a href="{% url 'add_expense_cje' expense.pk %}"><span class="btn btn-secondary">Revise using journal entry</span></a>
  {% endif %}
{% endblock %}
